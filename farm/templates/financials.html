{% extends 'base.html' %}

{% block content %}
<div class="space-y-6">
   <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800">Financial Tracking</h1>
        <button onclick="document.getElementById('financeModal').classList.remove('hidden')" class="bg-emerald-600 text-white px-4 py-2 rounded-lg flex gap-2 items-center">
            <i data-lucide="plus" class="w-5 h-5"></i> Add Record
        </button>
   </div>

   <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Simplified Chart Placeholder - In real Django use Chart.js with template data -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col justify-center items-center">
            <h3 class="text-lg font-semibold mb-4 w-full">Income vs Expenses</h3>
            <div class="w-full h-48 bg-gray-50 rounded flex items-end justify-around pb-4">
                 <div class="w-16 bg-emerald-500 rounded-t" style="height: {{ income_pct }}%;"></div>
                 <div class="w-16 bg-red-500 rounded-t" style="height: {{ expense_pct }}%;"></div>
            </div>
            <div class="flex gap-4 mt-2 text-sm">
                <span class="flex items-center gap-1"><div class="w-3 h-3 bg-emerald-500"></div> Income</span>
                <span class="flex items-center gap-1"><div class="w-3 h-3 bg-red-500"></div> Expenses</span>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-4">
            <div class="bg-green-50 p-6 rounded-xl border border-green-100">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-green-700 font-medium">Total Income</span>
                    <i data-lucide="trending-up" class="text-green-600 w-5 h-5"></i>
                </div>
                <span class="text-3xl font-bold text-green-800">Ksh {{ total_income }}</span>
            </div>
            <div class="bg-red-50 p-6 rounded-xl border border-red-100">
                 <div class="flex justify-between items-center mb-2">
                    <span class="text-red-700 font-medium">Total Expenses</span>
                    <i data-lucide="trending-down" class="text-red-600 w-5 h-5"></i>
                </div>
                <span class="text-3xl font-bold text-red-800">Ksh {{ total_expenses }}</span>
            </div>
            <div class="bg-emerald-600 p-6 rounded-xl text-white">
                <span class="block opacity-80 mb-1">Net Profit</span>
                <span class="text-3xl font-bold">Ksh {{ net_profit }}</span>
            </div>
        </div>
   </div>

   <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="p-4 bg-gray-50 border-b border-gray-100 font-bold text-gray-700">Recent Transactions</div>
        <table class="w-full text-sm text-left">
            <thead class="bg-white text-gray-500">
                <tr>
                    <th class="p-4">Date</th>
                    <th class="p-4">Description</th>
                    <th class="p-4">Category</th>
                    <th class="p-4 text-right">Amount</th>
                    <th class="p-4 text-center">Action</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
                {% for f in financials_list %}
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 text-gray-500">{{ f.date }}</td>
                        <td class="p-4 font-medium">{{ f.description }}</td>
                        <td class="p-4 text-gray-500">{{ f.category }}</td>
                        <td class="p-4 text-right font-bold {% if f.type == 'Income' %}text-green-600{% else %}text-red-600{% endif %}">
                            {% if f.type == 'Income' %}+{% else %}-{% endif %} {{ f.amount }}
                        </td>
                        <td class="p-4 text-center">
                            <form action="{% url 'delete_financial' f.id %}" method="POST" onsubmit="return confirm('Are you sure you want to delete this financial record?');">
                                {% csrf_token %}
                                <button class="text-gray-400 hover:text-red-500">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
   </div>

   <!-- Modal -->
   <div id="financeModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <form action="{% url 'add_financial' %}" method="POST" class="bg-white p-6 rounded-lg w-full max-w-sm space-y-4">
            {% csrf_token %}
            <h3 class="font-bold text-lg">Add Transaction</h3>
            <div class="flex gap-4">
                <label class="flex items-center"><input type="radio" name="type" value="Income" checked class="mr-2" /> Income</label>
                <label class="flex items-center"><input type="radio" name="type" value="Expense" class="mr-2" /> Expense</label>
            </div>
            <input type="date" name="date" required class="w-full border p-2 rounded" />
            <input type="number" name="amount" required class="w-full border p-2 rounded" placeholder="Amount" />
            <input name="category" required class="w-full border p-2 rounded" placeholder="Category (e.g. Feed, Sales)" />
            <input name="description" required class="w-full border p-2 rounded" placeholder="Description" />
            <button type="submit" class="w-full bg-emerald-600 text-white py-2 rounded">Save Record</button>
            <button type="button" onclick="document.getElementById('financeModal').classList.add('hidden')" class="w-full text-gray-500 py-2">Cancel</button>
        </form>
   </div>
</div>
{% endblock %}